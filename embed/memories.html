<section class="memories-page-section">
    <div class="memories-page-container">
        <div class="w-form">
            <form id="memories-form" name="memories-form" method="post" data-name="Memories Form">
                <!-- Header -->
                <div class="memories-page-header">
                    <div class="memories-page-kicker">Beta Testing</div>
                    <h1 class="memories-page-heading">Our Matching Memories</h1>
                    <p class="memories-page-subtitle">
                        Try it for free! Turn your relationship memories into a playful and loving memory matching game!
                        <br><br>
                        Add 8 of your favorite moments with your boo, adding a title, month/year, and a short
                        description.
                        We‚Äôll turn them into a custom game, made just for the two of you!
                        <br><br>
                        We'd love to hear your thoughts, such as your opinions and ideas for improvement. Please use
                        this form to share your feedback: <a
                            href="https://docs.google.com/forms/d/e/1FAIpQLSd9YPELioRtEfJf2u7-oYAVDEu2U1WfDt0ozg3j6jkV237jbA/viewform?usp=publish-editor">Submit
                            Feedback</a>
                    </p>
                    <!-- Hidden game session identifier used to link uploads, checkout, and game -->
                    <input id="game-session-id" name="game_session_id" type="hidden" />
                </div>
                <!-- Snapshot area start -->
                <div class="memories-snapshot-area">

                    <div class="video-container">
                        <div class="video-embed-wrapper video-frame">

                            <!-- Consent overlay -->
                            <div class="video-consent-overlay" aria-hidden="true">
                                <div class="video-consent-box">
                                    <div class="video-consent-title">Video preview</div>
                                    <div class="video-consent-text">
                                        To play this video, please accept Marketing cookies.
                                    </div>
                                    <button class="video-consent-btn" type="button" onclick="Cookiebot.renew()">
                                        Review cookie settings
                                    </button>
                                </div>
                            </div>

                            <!-- YouTube (blocked until consent) -->
                            <iframe data-cookieconsent="marketing"
                                data-src="https://www.youtube-nocookie.com/embed/RV4ZgvSade8?autoplay=1&mute=1&playsinline=1&loop=1&playlist=RV4ZgvSade8&rel=0&modestbranding=1"
                                title="Hi, I'm Boopi!" frameborder="0"
                                allow="autoplay; encrypted-media; picture-in-picture; web-share" allowfullscreen
                                loading="lazy">
                            </iframe>

                        </div>
                    </div>

                    <style>
                        /* Center the video on the page */
                        .video-container {
                            width: 100%;
                            display: flex;
                            justify-content: center;
                        }

                        /* 16:9 YouTube card */
                        .video-embed-wrapper {
                            width: 100%;
                            max-width: 900px;
                            /* prevents full width */
                            aspect-ratio: 16 / 9;
                            position: relative;
                            overflow: hidden;
                        }

                        /* Mobile */
                        @media (max-width: 768px) {
                            .video-embed-wrapper {
                                max-width: 100%;
                            }
                        }

                        .video-frame {
                            border-radius: 20px;
                            -webkit-mask-image: -webkit-radial-gradient(white, black);
                        }

                        /* Iframe */
                        .video-embed-wrapper iframe {
                            position: absolute;
                            inset: 0;
                            width: 100%;
                            height: 100%;
                            border: 0;
                            display: block;
                        }

                        /* Cookie consent overlay */
                        .video-consent-overlay {
                            position: absolute;
                            inset: 0;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            padding: 18px;
                            text-align: center;
                            z-index: 2;
                            background: rgba(0, 0, 0, 0.35);
                        }

                        .video-consent-box {
                            background: rgba(255, 255, 255, 0.92);
                            border-radius: 16px;
                            padding: 16px 14px;
                            max-width: 320px;
                            width: 100%;
                        }

                        .video-consent-title {
                            font-weight: 700;
                            margin-bottom: 6px;
                        }

                        .video-consent-text {
                            font-size: 14px;
                            line-height: 1.3;
                            margin-bottom: 10px;
                        }

                        .video-consent-btn {
                            font-size: 14px;
                            padding: 10px 12px;
                            border-radius: 12px;
                            border: 0;
                            cursor: pointer;
                        }
                    </style>

                    <script>
                        (function () {
                            const containers = document.querySelectorAll('.video-embed-wrapper');
                            containers.forEach(container => {
                                const overlay = container.querySelector('.video-consent-overlay');
                                const iframe = container.querySelector('iframe[data-cookieconsent]');
                                if (!overlay || !iframe) return;

                                iframe.addEventListener('load', () => {
                                    overlay.style.display = 'none';
                                });
                            });
                        })();
                    </script>

                    <script>
                        // Hide overlay once Cookiebot has swapped data-src -> src and the iframe loads.
                        (function () {
                            const root = document.currentScript && document.currentScript.parentElement;
                            const container = root ? root.querySelector('.video-square') : document.querySelector('.video-square');
                            if (!container) return;

                            const overlay = container.querySelector('.video-consent-overlay');
                            const iframe = container.querySelector('iframe[data-cookieconsent]');

                            if (!overlay || !iframe) return;

                            iframe.addEventListener('load', () => {
                                overlay.style.display = 'none';
                            });
                        })();
                    </script>

                    <!-- Gift details -->
                    <div class="memories-gift-section">
                        <h2 class="memories-gift-heading">Tell us about you and your partner</h2>
                        <p class="memories-gift-subtitle">
                            We‚Äôll use this info for checkout and to personalize your memory game.
                        </p>

                        <div class="memories-gift-grid">
                            <div class="memories-field">
                                <label for="from-name" class="memories-label">From</label>
                                <input id="from-name" name="from_name" type="text" class="memories-input"
                                    placeholder="Your name" maxlength="20" required />
                                <div class="memories-field-footer">
                                    <span class="memories-char-counter" data-for="from-name">0/20</span>
                                </div>
                            </div>


                            <div class="memories-field">
                                <label for="to-name" class="memories-label">To</label>
                                <input id="to-name" name="to_name" type="text" class="memories-input"
                                    placeholder="Their name" maxlength="20" required />
                                <div class="memories-field-footer">
                                    <span class="memories-char-counter" data-for="to-name">0/20</span>
                                </div>
                            </div>


                            <div class="memories-field">
                                <label for="from-email" class="memories-label">Email for checkout & game link</label>
                                <input id="from-email" name="from_email" type="email" class="memories-input"
                                    placeholder="name@email.com" required />
                                <p class="memories-help-text">
                                    We‚Äôll send the checkout link and the final game URL to this email.
                                </p>
                            </div>

                            <div class="memories-field memories-send-direct-field">
                                <label class="memories-label" for="send-direct-toggle">
                                    <input id="send-direct-toggle" name="send_direct" type="checkbox"
                                        class="memories-checkbox" />
                                    Check this if you‚Äôd like us to send your gift directly to your recipient
                                </label>

                                <p class="memories-help-text">
                                    If checked, we‚Äôll email the game link to your recipient after checkout.
                                </p>
                            </div>

                            <div class="memories-field" id="to-email-field" hidden>
                                <label for="to-email" class="memories-label">Recipient email</label>
                                <input id="to-email" name="to_email" type="email" class="memories-input"
                                    placeholder="recipient@email.com" />
                                <p class="memories-help-text">
                                    Required only if you want us to send it directly to your recipient.
                                </p>
                            </div>

                            <!-- Delivery scheduling (only if send-direct is checked) -->
                            <div class="memories-field" id="delivery-schedule-wrapper" hidden>
                                <label for="delivery-mode" class="memories-label">Delivery</label>
                                <select id="delivery-mode" name="delivery_scheduled" class="memories-input" disabled>
                                    <option value="false" selected>Send now</option>
                                    <option value="true">Schedule</option>
                                </select>


                                <p class="memories-help-text">
                                    Choose when we should email the gift link to your recipient.
                                </p>

                                <div id="delivery-schedule-fields" hidden>
                                    <div class="memories-field">
                                        <label for="delivery-date" class="memories-label">Delivery date</label>
                                        <input id="delivery-date" name="delivery_date" type="text"
                                            class="memories-input" disabled />
                                    </div>

                                    <div class="memories-field">
                                        <label for="delivery-time" class="memories-label">Delivery time</label>
                                        <input id="delivery-time" name="delivery_time" type="time"
                                            class="memories-input" disabled />
                                    </div>

                                    <div class="memories-field">
                                        <label for="delivery-timezone" class="memories-label">Delivery timezone</label>
                                        <select id="delivery-timezone" name="delivery_timezone" class="memories-input"
                                            disabled>
                                            <option value="" selected>Select timezone</option>

                                            <option value="-12">UTC-12 ‚Äî Baker Island (US)</option>
                                            <option value="-11">UTC-11 ‚Äî Pago Pago (American Samoa)</option>
                                            <option value="-10">UTC-10 ‚Äî Honolulu (Hawaii)</option>
                                            <option value="-9">UTC-9 ‚Äî Anchorage (Alaska)</option>
                                            <option value="-8">UTC-8 ‚Äî Los Angeles (US Pacific)</option>
                                            <option value="-7">UTC-7 ‚Äî Denver (US Mountain)</option>
                                            <option value="-6">UTC-6 ‚Äî Chicago (US Central)</option>
                                            <option value="-5">UTC-5 ‚Äî New York (US Eastern)</option>
                                            <option value="-4">UTC-4 ‚Äî Santiago (Chile)</option>
                                            <option value="-3">UTC-3 ‚Äî S√£o Paulo (Brazil)</option>
                                            <option value="-2">UTC-2 ‚Äî South Georgia</option>
                                            <option value="-1">UTC-1 ‚Äî Azores (Portugal)</option>

                                            <option value="+0">UTC¬±0 ‚Äî London (UK)</option>
                                            <option value="+1">UTC+1 ‚Äî Paris (France)</option>
                                            <option value="+2">UTC+2 ‚Äî Cairo (Egypt)</option>
                                            <option value="+3">UTC+3 ‚Äî Istanbul (Turkey)</option>
                                            <option value="+4">UTC+4 ‚Äî Dubai (UAE)</option>
                                            <option value="+5">UTC+5 ‚Äî Karachi (Pakistan)</option>
                                            <option value="+6">UTC+6 ‚Äî Dhaka (Bangladesh)</option>
                                            <option value="+7">UTC+7 ‚Äî Bangkok (Thailand)</option>
                                            <option value="+8">UTC+8 ‚Äî Singapore</option>
                                            <option value="+9">UTC+9 ‚Äî Tokyo (Japan)</option>
                                            <option value="+10">UTC+10 ‚Äî Sydney (Australia)</option>
                                            <option value="+11">UTC+11 ‚Äî Noum√©a (New Caledonia)</option>
                                            <option value="+12">UTC+12 ‚Äî Auckland (New Zealand)</option>
                                            <option value="+13">UTC+13 ‚Äî Nuku ªalofa (Tonga)</option>
                                            <option value="+14">UTC+14 ‚Äî Kiritimati (Kiribati)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>


                    <!-- Dynamic tiles are injected here by JS -->
                    <div class="memories-form-wrapper">
                        <div id="memories-grid" class="memories-grid"></div>
                    </div>

                    <!-- Custom message (optional) -->
                    <div class="memories-field memories-custom-message-field">
                        <label for="custom-message" class="memories-label">Custom message</label>
                        <textarea id="custom-message" name="custom_message" class="memories-textarea" maxlength="300"
                            placeholder="Optional ‚Äî shown when the game is completed."></textarea>

                        <div class="memories-field-footer">
                            <span class="memories-char-counter" data-for="custom-message">0/300</span>
                        </div>
                    </div>

                </div>
                <!-- Snapshot area end -->

                <!-- Progress + status + button -->
                <div class="memories-footer-row">
                    <div class="memories-progress-row">
                        <div class="memories-progress-label">
                            <strong><span id="memories-progress-count">0</span>/8</strong>
                            memories complete
                        </div>
                        <div class="memories-progress-bar-track">
                            <div id="memories-progress-bar" class="memories-progress-bar-fill"></div>
                        </div>
                    </div>

                    <div id="status-message" class="memories-status-text"></div>
                    <p class="memories-consent-text">
                        By tapping <strong>‚ÄúUpload Memories‚Äù</strong> below, you agree to our
                        <a href="#" data-open-modal="terms-modal">Terms of Use</a>
                        and
                        <a href="#" data-open-modal="privacy-modal">Privacy Policy</a>.
                    </p>
                    <div class="memories-actions-row">
                        <button id="submit-memories" type="submit" class="memories-primary-button">
                            <span class="memories-button-icon">‚¨ÜÔ∏è</span>
                            Upload memories
                        </button>
                    </div>
                </div>

                <!-- Hidden fields for Cloudinary snapshot info -->
                <input type="hidden" id="cloudinary-snapshot-url" name="cloudinary_snapshot_url" />
                <input type="hidden" id="cloudinary-snapshot-public-id" name="cloudinary_snapshot_public_id" />

                <!-- Hidden fields for Cloudinary JSON file info -->
                <input type="hidden" id="cloudinary-json-public-id" name="cloudinary_json_public_id" />
                <input type="hidden" id="cloudinary-json-url" name="cloudinary_json_url" />
            </form>

            <!-- Webflow success message (styled as Boopi celebration) -->
            <div class="w-form-done memories-success-wrapper">
                <div class="memories-success-inner">
                    <img src="https://res.cloudinary.com/dfrolhhx9/image/upload/v1733596800/boopi-celebrating-placeholder.png"
                        alt="Celebrating Boopi" class="memories-success-boopi" />
                    <div class="memories-success-heading">Memories received! üéâ</div>
                    <div class="memories-success-subtitle">
                        Your memories have been uploaded. We‚Äôll use them to assemble your
                        custom memory game. You can safely close this page now.
                    </div>
                    <button type="button" class="memories-success-close" onclick="window.location.href='/'">
                        Back to home
                    </button>
                </div>
            </div>

            <!-- Webflow error message -->
            <div class="w-form-fail">
                <div class="memories-fail-message">
                    Oops! Something went wrong while submitting the form. Please try
                    again.
                </div>
            </div>
        </div>
    </div>

    <!-- Cropper modal -->
    <div id="memories-cropper-modal" class="memories-cropper-modal">
        <div class="memories-cropper-backdrop"></div>
        <div class="memories-cropper-dialog">
            <div class="memories-cropper-title">Adjust your memory</div>
            <div class="memories-cropper-help">
                Zoom and drag to frame your memory in a square. This is how it will
                appear in the game.
            </div>
            <div class="memories-cropper-canvas-wrap">
                <img id="cropper-image" alt="Crop selected memory" />
            </div>
            <div class="memories-cropper-actions">
                <button type="button" id="cropper-cancel" class="memories-cropper-button cancel">
                    Cancel
                </button>
                <button type="button" id="cropper-apply" class="memories-cropper-button apply">
                    Use crop
                </button>
            </div>
        </div>
    </div>
</section>